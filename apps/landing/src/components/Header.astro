---
// 사이트 헤더 — 히어로 완료 후 슬라이드인, 고정 네비게이션
import AuthButton from "./AuthButton";
---

<header id="site-header" class="header-hidden">
  <div class="header-inner">
    <!-- 로고 -->
    <a href="#" class="header-logo" aria-label="PROJECT SOLARIS 홈">
      <span class="header-logo-sub">PROJECT</span>
      <span class="header-logo-main">SOLARIS</span>
    </a>

    <!-- 네비게이션 -->
    <nav class="header-nav" aria-label="주요 탐색">
      <a href="#section-world" class="header-link">세계관</a>
      <a href="#section-factions" class="header-link">진영</a>
      <a href="#section-system" class="header-link">시스템</a>
    </nav>

    <!-- Discord 로그인 -->
    <AuthButton client:idle />
  </div>
</header>

<script>
  const header = document.getElementById('site-header');
  if (header) {
    const HERO_STORAGE_KEY = "solaris:hero-completed";
    const HERO_EXPIRY_MS = 7 * 24 * 60 * 60 * 1000;

    function shouldForceHeroDone() {
      if (window.__SOLARIS_HERO_DONE) return true;
      if (new URLSearchParams(window.location.search).has("skip")) return true;

      try {
        const raw = localStorage.getItem(HERO_STORAGE_KEY);
        if (!raw) return false;
        const timestamp = Number.parseInt(raw, 10);
        return Number.isFinite(timestamp) && Date.now() - timestamp < HERO_EXPIRY_MS;
      } catch {
        return false;
      }
    }

    function showHeader() {
      header.classList.remove('header-hidden');
      header.classList.add('header-visible');
    }

    if (shouldForceHeroDone()) {
      showHeader();
    }

    window.addEventListener('solaris:hero-done', showHeader);
    window.addEventListener('solaris:hero-skipped', showHeader);
  }
</script>
