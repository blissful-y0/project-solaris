# Operation 통합 UI/UX 설계

> 2026-02-18 — Operation 허브 + OPERATION 전투 세션 + DOWNTIME 채팅방
> 심플 전투 계획서(`2026-02-18-simple-combat-resolution-plan.md`) 반영 완료

---

## 용어 정의

| 용어 | 의미 | 영문 라벨 |
|------|------|-----------|
| 작전 | 전투 세션 (1v1, 1v2, 2v1, 2v2) | OPERATION |
| 다운타임 | 일상 RP 채팅방 | DOWNTIME |
| 메인 스토리 | 운영자가 생성하는 시즌 이벤트 | MAIN STORY |

### 전투 형식
- 1v1, 1v2, 2v1, 2v2 (비대칭 허용)
- 팀당 최대 2명
- AI GM이 수적 열세를 판정에 반영

---

# Part 1: Operation 허브 (`/operation`)

## 페이지 구조

```
┌─────────────────────────────────────────────────────┐
│ OPERATION // TACTICAL HUB                           │
│                                                     │
│ ┌─────────────────────────────────────────────────┐ │
│ │ ⚡ MAIN STORY // ACTIVE                         │ │
│ │                                                 │ │
│ │  시즌 1 — 심층 구역 이상 징후                    │ │
│ │  HELIOS 최우선 작전 지시. 전 요원 소집.          │ │
│ │  참가자 8/12  ·  D-3  ·  2026.02.15 개설       │ │
│ │                              [작전 참가 ▸]       │ │
│ └─────────────────────────────────────────────────┘ │
│                                                     │
│ [ALL] [OPERATION] [DOWNTIME]         [+ 새 작전]    │
│ [전체] [대기] [LIVE] [완료]                         │
│                                                     │
│ ┌─┬──────────────────────────────────────────┐      │
│ │▌│ ● LIVE  OPERATION · 구역 7-B 정찰 작전   │      │
│ │▌│ 카이, 레이 vs 나디아 · 3/4 · 3h ago     │      │
│ │▌│ 외곽 구역 비동조 신호 탐지...             │      │
│ │▌│                              [입장 ▸]    │      │
│ └─┴──────────────────────────────────────────┘      │
│ ┌─┬──────────────────────────────────────────┐      │
│ │▌│ ○ 대기  DOWNTIME · 중앙 아케이드 야간     │      │
│ │▌│ 호스트: 나디아 볼코프 · 1/6 · 12m ago    │      │
│ │▌│ 민간 구역 순찰 중 교류...                 │      │
│ │▌│                              [참가 ▸]    │      │
│ └─┴──────────────────────────────────────────┘      │
│ ┌─┬──────────────────────────────────────────┐      │
│ │ │ — 완료  OPERATION · 외곽 지구 전면 공세   │      │
│ │ │ 레이 vs 아마츠키 · 4/4 · 2d ago         │      │
│ │ │ Static 거점 확인 및 제압 완료             │      │
│ │ │                              [열람 ▸]    │      │
│ └─┴──────────────────────────────────────────┘      │
└─────────────────────────────────────────────────────┘
```

---

## 1. 헤더

- `OPERATION // TACTICAL HUB` — `hud-label` 스타일
- 아래에 서브 텍스트: `통합 작전 목록` (text-xl bold)
- 우측에 총 건수 표시: `6개 채널`

---

## 2. MAIN STORY 배너

운영자가 생성한 시즌 이벤트가 LIVE일 때만 상단에 노출.

### 스타일
- HUD 코너 브래킷 (`hud-corners`)
- 보더: `border-primary/40`
- 글로우: `shadow-[0_0_20px_rgba(0,212,255,0.15)]`
- 배경: `bg-primary/5`

### 내용
- 라벨: `⚡ MAIN STORY // ACTIVE` (hud-label, 시안 글로우)
- 제목: 시즌 + 이벤트명 (text-lg bold)
- 설명: 1~2줄
- 메타: `참가자 N/M  ·  D-X  ·  YYYY.MM.DD 개설`
- CTA: `[작전 참가 ▸]` — primary 버튼

### 조건
- 운영자 이벤트 없음 → 섹션 전체 숨김
- 이벤트 완료 → 숨김 (완료 이벤트는 일반 목록에서 열람)

---

## 3. 필터 + 생성 버튼

### 1행: 타입 필터 + 생성 CTA
- `FilterChips` 컴포넌트: `ALL` / `OPERATION` / `DOWNTIME`
- 우측: `+ 새 작전` 버튼 (Button variant=outline, size=sm)

### 2행: 상태 필터
- `FilterChips` 컴포넌트: `전체` / `대기` / `LIVE` / `완료`

---

## 4. 작전 카드 (OperationCard)

### 상태별 스타일

| 상태 | stripe 색상 | 인디케이터 | CTA |
|------|------------|-----------|-----|
| LIVE (진행중) | `bg-emerald-500` | `● LIVE` (pulse 애니메이션) | `입장 ▸` |
| 대기중 | `bg-primary` (cyan) | `○ 대기` | `참가 ▸` |
| 완료 | `bg-text-secondary/30` | `— 완료` | `열람 ▸` |

### 카드 구조

```
┌─┬──────────────────────────────────────────┐
│▌│ ● LIVE   OPERATION   구역 7-B 정찰 작전  │  ← 1행: 상태 · 타입뱃지 · 제목
│▌│                                          │
│▌│ 카이 안데르센, 레이 vs 나디아 볼코프      │  ← 2행: 참가자
│▌│ 외곽 구역 비동조 신호 탐지...             │  ← 3행: 요약 (line-clamp-1)
│▌│                                          │
│▌│ 3/4명  ·  3시간 전              [입장 ▸]  │  ← 4행: 메타 + CTA
└─┴──────────────────────────────────────────┘
```

### 타입별 차이

**OPERATION 카드:**
- 참가자: `팀A vs 팀B` 형태 (이름 나열)
- 뱃지: `info` variant (시안)

**DOWNTIME 카드:**
- 참가자: `호스트: 이름` 형태
- 뱃지: `warning` variant (앰버)

### 공통 스타일
- 좌측 stripe: `w-1` 세로 바 (상태별 색상)
- 배경: `bg-bg-secondary/80 border border-border`
- 호버: `hover:border-primary/30`
- 완료 카드: `opacity-60`

---

## 5. "새 작전" 생성 모달

`+ 새 작전` 클릭 시 모달 오픈.

### 모달 구조

```
┌ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ┐
  NEW OPERATION // 작전 생성
│                                  │
  타입 선택
│ [작전 개시]    [다운타임 개설]     │

  ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─
│                                  │
  제목 ___________________________
│                                  │
  상황 설명 ______________________
│ ________________________________ │
  ________________________________
│                                  │
  (타입에 따라 다른 필드)
│                                  │
│              [취소]  [작전 생성]  │
└ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ┘
```

### "작전 개시" (OPERATION) 선택 시
- 아군 진영: 본인 자동 포함 + 1명 추가 가능 (캐릭터 검색)
- 적군 진영: 1~2명 선택 (캐릭터 검색)
- 최대: 각 팀 2명 (2v2), 비대칭 허용 (1v2, 2v1)
- 제출 시 상대에게 Discord 알림

### "다운타임 개설" (DOWNTIME) 선택 시
- 참가자 초대: 복수 선택 가능 (선택 사항)
- 인원 상한 없음
- 링크 공유로도 참가 가능

---

## 6. 반응형 레이아웃

| 뷰포트 | 카드 그리드 | MAIN STORY 배너 |
|--------|-----------|-----------------|
| 모바일 | 1열 | 풀폭 |
| 데스크탑 (lg+) | 2열 | 풀폭 |

---

## 7. 빈 상태

### 작전 0건
```
등록된 작전이 없습니다.
새 작전을 생성해 보세요.

        [+ 새 작전]
```

### 필터 결과 0건
```
조건에 맞는 작전이 없습니다.
```

---

## 8. 접근 제어

- **캐릭터 미승인**: `AccessDenied` 컴포넌트 (현재 구현 유지)
- **캐릭터 승인됨**: Operation Hub 전체 표시
- MAIN STORY 배너: 승인된 캐릭터만 참가 버튼 활성화

---

# Part 2: OPERATION 전투 세션 (`/operation/[id]`)

> 심플 전투 계획서(`2026-02-18-simple-combat-resolution-plan.md`) 기반
> 순차 턴제 (SERVICE-SPEC) 채택

## 턴 구조 (순차형)

```
A: 행동 선언 + 서술 작성 → 제출
     ↓
B: A의 서술 확인 → 대응 행동 선언 + 서술 작성 → 제출
     ↓
양쪽 확인 + "판정 진행" 클릭 (합의)
     ↓
AI GM 판정 실행 (5~10초)
     ↓
결과 표시 (판정 등급 + HP/WILL 변동) + 다음 턴
```

- 서술 수정: 합의 전 1회 허용
- 타임아웃: 10분. 초과 시 자동 패스 (GM이 소극적 행동으로 판정)
- 전투 중단: 한 쪽 요청 → 상대 수락 시 중단. 24시간 미응답 시 자동 중단.

## 전체 레이아웃

```
┌─────────────────────────────────────────┐
│ ← 구역 7-B 정찰 작전          ⋯ 메뉴   │  ← 상단 바
├─────────────────────────────────────────┤
│ 카이     ████████░░  HP 64/80          │  ← HP/WILL 미니 바
│ 나디아   ██████░░░░  HP 72/120         │
├─────────────────────────────────────────┤
│                                         │
│  [카이의 서술]                           │
│  ┌─────────────────────────────┐        │
│  │ 카이는 왼쪽 전도관 뒤로     │        │  ← 상대 말풍선 (좌)
│  │ 몸을 낮췄다. 헬리오스의...  │        │
│  └─────────────────────────────┘        │
│                                         │
│        ┌─────────────────────────┐      │
│        │ 증기가 터지는 순간      │      │  ← 내 말풍선 (우)
│        │ 재는 배관에서 손을...   │      │
│        └─────────────────────────┘      │
│                                         │
│  ┌ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ┐     │
│    ⚡ HELIOS COMBAT SYSTEM               │  ← GM 판정 (중앙)
│  │ 판정: Partial                       │ │
│    서술 합리성 8/10 · 전술 9/10         │
│  │ HP -15 → 카이 49/80                │ │
│  └ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ┘     │
│                                         │
├─────────────────────────────────────────┤
│ 턴 2 · 나의 차례                        │
│                                         │
│ ── 행동 선언 ──                          │
│ [⚔ attack] [🎯 disrupt] [🛡 defend] [💫 support] │
│                                         │
│ 능력: [변환 — 발화 (기본기)]       ▼    │
│ 코스트: HP -15                          │
│ 대상: [나디아 볼코프]             ▼    │
│                                         │
│ ── 서술 ──                               │
│ ┌─────────────────────────────────────┐ │
│ │ 서술을 입력하세요...                │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ HP 72 → 57 (코스트 반영 미리보기)       │
│                   [OOC] [확장]  [제출]   │
└─────────────────────────────────────────┘
```

---

## 1. 상단 바

- `←` 뒤로가기 (Operation 허브로)
- 작전 제목
- `⋯` 메뉴: 전투 중단 요청, 관전 링크 공유

---

## 2. HP/WILL 미니 바

참가자별 HP 바 한 줄 (얇은 프로그레스). 탭하면 WILL 포함 상세 패널 확장.

### 1v1
```
카이     ████████░░  HP 64/80
나디아   ██████░░░░  HP 72/120
```

### 2v2 (팀별 그룹핑)
```
── 아군 ──
카이     HP ████████░░ 64/80   WILL ██████░ 198/250
레이     HP ██████░░░░ 55/80   WILL █████░░ 180/250
── 적군 ──
나디아   HP ██████░░░░ 72/120
시온     HP ████████░░ 96/120
```

---

## 3. 채팅 로그

- **내 서술**: 우측 말풍선, `bg-primary/10 border-primary/20`
- **상대 서술**: 좌측 말풍선, `bg-bg-tertiary border-border`
- **GM 판정**: 중앙 시스템 메시지, 시안 보더 + HUD 스타일
  - 판정 등급: **Success / Partial / Fail** (3단계, Critical 없음)
  - 평가 항목 점수
  - HP/WILL 변동 수치

---

## 4. 행동 선언 + 서술 입력 영역

### 행동 선언 (심플 전투 계획서 반영)

**action_type 선택 (4종):**
- `attack` — 적 HP 공격
- `disrupt` — 적 WILL/RESOURCE 교란
- `defend` — 아군 피해 경감 (지정 아군의 이번 턴 첫 피해 ×0.5)
- `support` — 아군 공격 강화 (지정 아군의 이번 턴 첫 공격 multiplier +0.25, 상한 1.0)

**능력 선택:**
- 드롭다운: 내 캐릭터의 능력 목록 (기본기/중급기/상급기)
- 선택 시 `cost_hp`/`cost_will` 자동 표시

**대상 선택:**
- attack/disrupt: 적군 드롭다운
- defend/support: 아군 드롭다운

**코스트 프리뷰:**
- 선택한 능력의 코스트를 `HP 72 → 57` 형태로 미리 표시
- 코스트 부족 시: 빨간색 경고 텍스트 + 제출 버튼 비활성화

### 자유 서술
- 행동 선언 아래 텍스트 입력
- `[확장]` 버튼: 풀스크린 에디터 (장문 서술용)

### 하단 버튼
- `[OOC]`: OOC 채팅 바텀 시트 토글
- `[확장]`: 풀스크린 에디터
- `[제출]`: 행동 선언 + 서술 제출

---

## 5. 판정 결과 표시

### 판정 등급 (심플 버전 — Critical 없음)

| Grade | Multiplier | UI 표시 |
|-------|-----------|---------|
| Success | 1.0 | 시안 강조, "SUCCESS" |
| Partial | 0.5 | 앰버 강조, "PARTIAL" |
| Fail | 0.0 | 회색, "FAIL" |

### GM 판정 카드 (중앙 시스템 메시지)

```
┌ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ┐
  ⚡ HELIOS COMBAT SYSTEM // TURN 2
│                                      │
  카이: SUCCESS · 나디아: PARTIAL
│                                      │
  서술 합리성 8/10  전술 9/10
│ 대가 반영 7/10  서술 품질 8/10       │
│                                      │
  ── 스탯 변동 ──
│ 카이:   HP 64→49 (-15, 코스트)       │
│         WILL 198→193 (-5, 코스트)    │
  나디아: HP 72→52 (-20, 피해)
│                                      │
  ── 서사 ──
│ 열이 역장 하단을 침투해 거울의      │
  발밑이 달아오른다. 자세가 흐트러진
│ 찰나에...                            │
└ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ┘
```

---

## 6. 턴 상태별 UI

| 상태 | 입력 영역 | 안내 텍스트 |
|------|----------|------------|
| 내 차례 | 행동 선언 + 서술 입력 활성화 | `턴 N · 나의 차례` |
| 대기 중 | 입력 비활성화 | `상대의 서술을 기다리는 중...` |
| 양측 완료 | `판정 진행` 버튼 표시 | `양측 서술 완료. 판정을 진행하세요.` |
| 판정 중 | 로딩 스피너 | `HELIOS 판정 처리 중...` (5~10초) |
| 판정 완료 | 결과 카드 표시 후 다음 턴 | GM 판정 카드 + 서사 |

---

## 7. OOC 채팅

- 바텀 시트 (bottom sheet)로 올려서 사용
- 전투 로그와 완전 분리
- IC(In-Character) 서술과 혼동 방지
- 서술 수정 합의, 전투 중단 논의 등에 사용

---

## 8. 전투 종료

### 종료 조건
- HP 0 → 전투불능 (사망은 플레이어 동의 시에만)
- 양측 합의 항복/종료
- 중단 후 미재개
- 2v2: 한 팀 전원 HP 0 → 패배

### 종료 화면
- 전투 결과 요약 (승/패/중단)
- 전체 턴 로그 아카이브
- `[Operation 허브로 돌아가기]` 버튼

---

# Part 3: DOWNTIME 채팅방 (`/room/[id]`)

## 전체 레이아웃

```
┌─────────────────────────────────────────┐
│ ← 중앙 아케이드 야간 순찰    👥3  ⋯    │  ← 상단 바
├─────────────────────────────────────────┤
│                                         │
│  [나디아 볼코프]                         │
│  ┌─────────────────────────────┐        │
│  │ 아케이드의 네온 간판이 깜빡 │        │  ← 좌측 말풍선
│  │ 거리며 골목을 비춘다...     │        │
│  └─────────────────────────────┘        │
│                                         │
│        ┌─────────────────────────┐      │
│        │ 시온은 간판 아래 서서   │      │  ← 우측 (나)
│        │ 주변을 살폈다...       │      │
│        └─────────────────────────┘      │
│                                         │
│  [카이 안데르센]                         │
│  ┌─────────────────────────────┐        │
│  │ "조용하군." 카이가 골목     │        │  ← 좌측 (타인)
│  │ 끝을 가리키며 말했다.       │        │
│  └─────────────────────────────┘        │
│                                         │
│  ┌ · · · · · · · · · · · · · · ┐       │
│    📋 서사 반영 요청                     │  ← 시스템 메시지
│  │ 나디아가 서사 반영을 요청했습니다.  │ │
│  │ 동의: 1/3              [동의]      │ │
│  └ · · · · · · · · · · · · · · ┘       │
│                                         │
├─────────────────────────────────────────┤
│ [서술 입력...]                    [▶]   │  ← 입력 영역
│                         [서사반영] [⚔]  │
└─────────────────────────────────────────┘
```

---

## 1. 상단 바

- `←` 뒤로가기 (Operation 허브로)
- 방 제목
- `👥N` 참가자 수 (탭하면 참가자 목록 패널)
- `⋯` 메뉴: 초대 링크 복사, 방 나가기

---

## 2. 채팅 로그

- **내 서술**: 우측 말풍선
- **타인 서술**: 좌측 말풍선 + 캐릭터 이름 헤더 (아바타 썸네일 선택)
- **시스템 메시지**: 중앙, 점선 보더
  - 입장/퇴장 알림
  - 서사 반영 요청/완료
  - 전투방 생성 알림

### OPERATION과의 차이
- 행동 선언 없음 (자유 서술만)
- GM 판정 없음
- HP/WILL 바 없음
- 턴제 없음 (자유 진행)

---

## 3. 입력 영역

- 텍스트 입력 + 제출 버튼
- `[서사반영]` 버튼: 서사 반영 플로우 시작
- `[⚔]` 버튼: 전투방 생성 (OPERATION으로 전환)

---

## 4. 서사 반영 기능

### 플로우
1. 메시지 범위 선택: 롱프레스 → "여기서부터" 마킹 → 스크롤 → "여기까지" 마킹
2. "서사 반영 요청" 버튼 클릭
3. 시스템 메시지로 투표 카드 표시
4. 각 참가자가 `[✔ 반영]` 또는 `[✖ 미반영]` 선택
5. **전원 "반영" 선택 시에만** AI에게 전송 → 서사 기록 반영
6. 한 명이라도 "미반영" 선택 → 요청 즉시 취소
7. **스탯(HP/WILL) 변동 없음.** 서사 기록만.

### 투표 시스템 메시지
```
┌ · · · · · · · · · · · · · · · · · · ┐
  📋 서사 반영 요청
│ 나디아가 #12~#28 범위의 서사 반영을  │
  요청했습니다.
│                                      │
  나디아: ✔ 반영
│ 카이:   ✔ 반영                       │
  시온:   대기중...
│                                      │
│ 동의: 2/3          [✔ 반영] [✖ 미반영] │
└ · · · · · · · · · · · · · · · · · · ┘
```

- 본인 미투표 시: `[✔ 반영] [✖ 미반영]` 버튼 표시
- 투표 완료 시: 본인 선택에 체크 표시, 버튼 숨김
- 전원 반영: `서사 반영이 완료되었습니다.` 시스템 메시지 + AI 처리
- 누구든 미반영: `서사 반영이 취소되었습니다.` 시스템 메시지

---

## 5. 전투 전환

- RP 중 전투 발생 시 `[⚔]` 버튼 클릭
- 참가자 2~4명 지정 (팀 분배)
- OPERATION 전투방 자동 생성 (허브에도 등록)
- 전투 종료 후 결과가 DOWNTIME방에 시스템 메시지로 돌아옴:

```
┌ · · · · · · · · · · · · · · ┐
  ⚡ 전투 종료
│ [카이 vs 나디아] — 카이 승리         │
  HP: 카이 32/80, 나디아 0/120
│                  [전투 로그 열람]     │
└ · · · · · · · · · · · · · · ┘
```

---

# Part 4: 공통 사항

## 관전 모드 (`/operation/[id]?spectate=true`)

- OPERATION 전투 세션 읽기 전용
- 채팅 UI 동일하되 입력창 없음
- 허브에서 "진행중" OPERATION 클릭 시 → 참가자가 아니면 관전 모드 진입

## 수정/신규 파일 예상

### 허브
| 파일 | 변경 |
|------|------|
| `components/operation/types.ts` | 타입 전면 재정의 |
| `components/operation/OperationCard.tsx` | 도시어 카드 전면 재작성 |
| `components/operation/OperationHub.tsx` | 필터 변경 + MAIN STORY + 생성 버튼 |
| `components/operation/MainStoryBanner.tsx` | 신규 |
| `components/operation/CreateOperationModal.tsx` | 신규 |
| `components/operation/mock-operation-data.ts` | 목 데이터 갱신 |
| `app/(dashboard)/operation/page.tsx` | 페이지 구조 업데이트 |

### 전투 세션
| 파일 | 변경 |
|------|------|
| `app/(dashboard)/operation/[id]/page.tsx` | 신규 — 전투 세션 페이지 |
| `components/operation/session/BattleSession.tsx` | 신규 — 전투 세션 메인 |
| `components/operation/session/StatBar.tsx` | 신규 — HP/WILL 미니 바 |
| `components/operation/session/ChatLog.tsx` | 신규 — 채팅 로그 |
| `components/operation/session/ActionInput.tsx` | 신규 — 행동 선언 + 서술 입력 |
| `components/operation/session/JudgmentCard.tsx` | 신규 — GM 판정 결과 카드 |
| `components/operation/session/OocChat.tsx` | 신규 — OOC 바텀 시트 |

### 다운타임
| 파일 | 변경 |
|------|------|
| `app/(dashboard)/room/[id]/page.tsx` | 신규 — 다운타임 페이지 |
| `components/room/DowntimeRoom.tsx` | 신규 — 다운타임 메인 |
| `components/room/RoomChatLog.tsx` | 신규 — 채팅 로그 |
| `components/room/NarrativeReflection.tsx` | 신규 — 서사 반영 UI |

### 테스트
- 각 컴포넌트별 유닛 테스트
